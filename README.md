# Проектная работа для курса DevOps практики и инструменты

## Инфраструктура

Для создания инфраструктуры используется Yandex Cloud. Есть 2 способа развернуть приложение:
* На виртуальных машинах
* С помощью kubernetes сервиса яндекса

### Инфраструтура на виртуальных машинах

Для создания образа, который будет включать необходимый софт нужно в директории packer выполнить команду `packer build --var-file=packer/variables.json packer/docker.json`. Предварительно добавить в файл `variables.json` значения своих переменных (примеры есть в `variables.json.example`)

Для создания виртуальных машин нужно в директории terrafrom нужно выполнить следующие команды: `terraform init` и `terraform apply --auto-approve`. Предварительно нужно в файл `terraform.tfvars` добавить свои значения для переменных (примеры есть в `terraform.tfvars.example`)

В этом случае будет поднята база, очередь, прометеус для сбора метрик. Также будет доступен `node-exporter` и `mongodb-exporter` для сбора метрик с виртуалок и с базы. Для логирования используется elastic и kibana, а для трасировки zipkin

Для CI/CD используется `GitHub Actions`. Здесь происходит запуск тестов приложения, валидация терраформа, пакера.
Также есть джобы, которые можно запустить руками:
- `build_docker_images.yml` - Обновляет Docker образа
- `deploy_app_vm.yml` - Поднимает приложение на виртуалках

### Инфраструтура kubernetes

Для создания k8s кластера нужно в директории terrafrom_k8s нужно выполнить следующие команды: `terraform init` и `terraform apply --auto-approve`. Предварительно нужно в файл `terraform.tfvars` добавить свои значения для переменных (примеры есть в `terraform.tfvars.example`)

Для добавления информации о созданом кластере нужно выполнить команду `yc managed-kubernetes cluster get-credentials <cluster_name> --external`

Для создани узлов нужно в директории kubernetes выполнить команду `kubectl apply -f app`

В данный момент запускается только само приложение (с базой и очередью)
